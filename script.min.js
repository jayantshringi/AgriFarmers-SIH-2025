"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("service-worker.js").then(e=>{console.log("✅ Service Worker registered with scope:",e.scope),e.addEventListener("updatefound",()=>{const t=e.installing;console.log("New service worker found:",t.state),t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&console.log("New content available, refresh to update.")})})}).catch(e=>{console.log("❌ Service Worker registration failed:",e)})});const CONFIG={WEATHER_API_KEY:"44a55de0f2e0674cb9160f50459d51d4",WEATHER_API_URL:"https://api.openweathermap.org/data/2.5",CROP_PRICE_API:"https://api.data.gov.in/resource/9ef84268-d588-465a-a308-a864a43d0070",OTP_EXPIRY_MINUTES:5,MAX_LOGIN_ATTEMPTS:3,APP_NAME:"Agritarmers",VERSION:"3.1.0",DEBUG_MODE:!1},translations={en:{app_title:"Agritarmers - Your Farming Companion",app_name:"Agritarmers",loading_message:"Loading your farming assistant...",offline_label:"Offline",offline_mode:"Offline Mode - Some data may be cached",welcome_title:"Welcome to Agritarmers",welcome_subtitle:"Your trusted companion for modern farming.",get_started_button:"Get Started",login_button:"Login",login_title:"Welcome Back",mobile_number_label:"Mobile Number",mobile_placeholder:"Enter 10-digit mobile number",mobile_error:"Please enter a valid 10-digit mobile number",no_account_text:"New here?",signup_link:"Create account",signup_title:"Join Agritarmers",full_name_label:"Full Name",name_placeholder:"Your Name",name_error:"Please enter your full name",state_label:"State",select_state:"Select State",state_error:"Please select your state",district_label:"District",select_district:"Select District",district_error:"Please select your district",signup_button:"Create Account",have_account_text:"Already have an account?",login_link:"Sign in",welcome_text:"Hello",personalized_dashboard:"Your personalized dashboard",weather_info:"Weather Forecast",weather_subtitle:"Today's weather & forecast",seed_advice:"Seed Recommendations",seed_subtitle:"Best seeds for your region",fertilizer_guide:"Fertilizer Guide",fertilizer_subtitle:"Nutrients for your crops",crop_calendar:"Crop Calendar",crop_subtitle:"Seasonal planting guide",market_prices:"Market Prices",market_subtitle:"Current crop prices",soil_health:"Soil Health",soil_subtitle:"Soil testing guidance",current_weather:"Current Weather",feels_like:"Feels like",humidity:"Humidity",wind:"Wind",pressure:"Pressure",visibility:"Visibility",sunrise:"Sunrise",sunset:"Sunset",forecast:"5-Day Forecast",weather_loading:"Loading weather data...",weather_error:"Unable to fetch weather data",offline_weather:"Offline Weather Data",farming_advisory:"Farming Advisory",high_temp_alert:"High temperature alert! Water crops in early morning or late evening.",low_temp_alert:"Low temperature! Protect sensitive crops with covers.",good_weather_alert:"Good weather for farming activities. Ideal for irrigation and fertilization.",connect_internet:"Connect to internet for real-time updates",seed_recommendation:"{season} Season",seed_tip:"Tip: Always use certified seeds from authorized dealers for better yield.",seed_consult:"Consult with local agriculture officer for region-specific recommendations.",npk_ratio:"NPK Ratio",nitrogen_phosphorus_potassium:"Nitrogen:Phosphorus:Potassium",application_time:"Application Time",before_sowing:"Before Sowing",basal_dose:"Basal dose recommended",soil_testing_important:"Important: Soil testing is recommended before fertilizer application.",season:"Season",sowing:"Sowing",harvesting:"Harvesting",crops:"Crops",current_recommendation:"Current Recommendation",kharif_time:"Now is the perfect time for Kharif crops like Rice and Cotton.",rabi_time:"Now is the perfect time for Rabi crops like Wheat and Mustard.",zaid_time:"Now is good time for Zaid crops like Watermelon and Cucumber.",wheat_price:"Wheat",rice_price:"Rice",cotton_price:"Cotton",per_quintal:"/q",fetching_prices:"Fetching latest market prices...",offline_prices:"Offline: Prices may not be current.",soil_testing_steps:"Soil Testing Steps",soil_step_1:"Collect soil samples from different spots",soil_step_2:"Mix samples thoroughly",soil_step_3:"Visit nearest Krishi Vigyan Kendra",soil_step_4:"Get soil health card with recommendations",kvk_contact:"KVK Contact Info",kvk_info:"Search for nearest Krishi Vigyan Kendra (KVK) in your district.",otp_sent:"OTP Sent",otp_display:"Your OTP is",otp_verification:"OTP Verification",enter_otp:"Enter 6-digit OTP",verify_otp:"Verify OTP",resend_otp:"Resend OTP",otp_valid_for:"OTP valid for {minutes} minutes",otp_demo_note:"Demo: Your OTP is shown below",back_to_login:"Back to Login",logout_button:"Logout",profile_button:"Profile",toast_online:"Back online!",toast_offline:"You are offline. Some features may be limited.",toast_login_success:"Login successful! Welcome back!",toast_signup_success:"Account created successfully! Welcome to Agritarmers!",toast_logout:"Logged out successfully",toast_otp_sent:"OTP sent successfully!",toast_new_otp:"New OTP sent!",error_no_account:"No account found. Please sign up first.",error_invalid_otp:"Invalid OTP. Please try again.",error_network:"Network error. Please check your connection.",retry:"Retry",close:"Close",online:"Online",offline_limited:"Offline - Limited functionality",tip:"Tip",important:"Important",invalid_input:"Invalid input",checking_connectivity:"Checking connectivity..."},hi:{app_title:"अग्रीफार्मर्स - आपका कृषि साथी",app_name:"अग्रीफार्मर्स",loading_message:"आपका कृषि सहायक लोड हो रहा है...",offline_label:"ऑफलाइन",offline_mode:"ऑफलाइन मोड - कुछ डेटा कैश किया गया हो सकता है",welcome_title:"अग्रीफार्मर्स में आपका स्वागत है",welcome_subtitle:"आधुनिक खेती के लिए आपका विश्वसनीय साथी।",get_started_button:"शुरू करें",login_button:"लॉग इन",login_title:"वापसी पर स्वागत है",mobile_number_label:"मोबाइल नंबर",mobile_placeholder:"10 अंकों का मोबाइल नंबर दर्ज करें",mobile_error:"कृपया एक वैध 10-अंकीय मोबाइल नंबर दर्ज करें",no_account_text:"नए हैं?",signup_link:"खाता बनाएं",signup_title:"अग्रीफार्मर्स से जुड़ें",full_name_label:"पूरा नाम",name_placeholder:"आपका नाम",name_error:"कृपया अपना पूरा नाम दर्ज करें",state_label:"राज्य",select_state:"राज्य चुनें",state_error:"कृपया अपना राज्य चुनें",district_label:"जिला",select_district:"जिला चुनें",district_error:"कृपया अपना जिला चुनें",signup_button:"खाता बनाएं",have_account_text:"पहले से खाता है?",login_link:"साइन इन",welcome_text:"नमस्ते",personalized_dashboard:"आपका व्यक्तिगत डैशबोर्ड",weather_info:"मौसम पूर्वानुमान",weather_subtitle:"आज का मौसम और पूर्वानुमान",seed_advice:"बीज सिफारिशें",seed_subtitle:"आपके क्षेत्र के लिए सर्वोत्तम बीज",fertilizer_guide:"उर्वरक गाइड",fertilizer_subtitle:"आपकी फसलों के लिए पोषक तत्व",crop_calendar:"फसल कैलेंडर",crop_subtitle:"मौसमी रोपण गाइड",market_prices:"बाजार मूल्य",market_subtitle:"वर्तमान फसल मूल्य",soil_health:"मृदा स्वास्थ्य",soil_subtitle:"मृदा परीक्षण मार्गदर्शन",current_weather:"वर्तमान मौसम",feels_like:"अनुभव",humidity:"आर्द्रता",wind:"हवा",pressure:"दबाव",visibility:"दृश्यता",sunrise:"सूर्योदय",sunset:"सूर्यास्त",forecast:"5-दिन पूर्वानुमान",weather_loading:"मौसम डेटा लोड हो रहा है...",weather_error:"मौसम डेटा प्राप्त करने में असमर्थ",offline_weather:"ऑफलाइन मौसम डेटा",farming_advisory:"कृषि परामर्श",high_temp_alert:"उच्च तापमान चेतावनी! फसलों को सुबह जल्दी या शाम को पानी दें।",low_temp_alert:"कम तापमान! संवेदनशील फसलों को कवर से बचाएं।",good_weather_alert:"खेती की गतिविधियों के लिए अच्छा मौसम। सिंचाई और उर्वरक के लिए आदर्श।",connect_internet:"रीयल-टाइम अपडेट के लिए इंटरनेट से कनेक्ट करें",seed_recommendation:"{season} सीजन के लिए अनुशंसित",seed_tip:"टिप: बेहतर उपज के लिए हमेशा प्रमाणित बीज अधिकृत डीलरों से उपयोग करें।",seed_consult:"क्षेत्र-विशिष्ट सिफारिशों के लिए स्थानीय कृषि अधिकारी से परामर्श करें।",npk_ratio:"एनपीके अनुपात",nitrogen_phosphorus_potassium:"नाइट्रोजन:फॉस्फोरस:पोटेशियम",application_time:"आवेदन समय",before_sowing:"बुवाई से पहले",basal_dose:"बेसल खुराक की सिफारिश की जाती है",soil_testing_important:"महत्वपूर्ण: उर्वरक आवेदन से पहले मृदा परीक्षण की सिफारिश की जाती है।",season:"मौसम",sowing:"बुवाई",harvesting:"कटाई",crops:"फसलें",current_recommendation:"वर्तमान सिफारिश",kharif_time:"अब खरीफ फसलों जैसे चावल और कपास के लिए सही समय है।",rabi_time:"अब रबी फसलों जैसे गेहूं और सरसों के लिए सही समय है।",zaid_time:"अब जायद फसलों जैसे तरबूज और खीरे के लिए अच्छा समय है।",wheat_price:"गेहूं",rice_price:"चावल",cotton_price:"कपास",per_quintal:"/क्विंटल",fetching_prices:"नवीनतम बाजार मूल्य प्राप्त किए जा रहे हैं...",offline_prices:"ऑफलाइन: कीमतें वर्तमान नहीं हो सकती हैं।",soil_testing_steps:"मृदा परीक्षण चरण",soil_step_1:"विभिन्न स्थानों से मिट्टी के नमूने एकत्र करें",soil_step_2:"नमूनों को अच्छी तरह मिलाएं",soil_step_3:"निकटतम कृषि विज्ञान केंद्र पर जाएं",soil_step_4:"सिफारिशों के साथ मृदा स्वास्थ्य कार्ड प्राप्त करें",kvk_contact:"केवीके संपर्क जानकारी",kvk_info:"अपने जिले में निकटतम कृषि विज्ञान केंद्र (केवीके) खोजें।",otp_sent:"ओटीपी भेजा गया",otp_display:"आपका ओटीपी है",otp_verification:"ओटीपी सत्यापन",enter_otp:"6-अंकीय ओटीपी दर्ज करें",verify_otp:"ओटीपी सत्यापित करें",resend_otp:"ओटीपी पुनः भेजें",otp_valid_for:"ओटीपी {minutes} मिनट के लिए वैध",otp_demo_note:"डेमो: आपका ओटीपी नीचे दिखाया गया है",back_to_login:"लॉगिन पर वापस जाएं",logout_button:"लॉग आउट",profile_button:"प्रोफ़ाइल",toast_online:"ऑनलाइन वापस!",toast_offline:"आप ऑफलाइन हैं। कुछ सुविधाएं सीमित हो सकती हैं।",toast_login_success:"लॉगिन सफल! वापसी पर स्वागत है!",toast_signup_success:"खाता सफलतापूर्वक बनाया गया! अग्रीफार्मर्स में आपका स्वागत है!",toast_logout:"सफलतापूर्वक लॉग आउट किया गया",toast_otp_sent:"ओटीपी सफलतापूर्वक भेजा गया!",toast_new_otp:"नया ओटीपी भेजा गया!",error_no_account:"कोई खाता नहीं मिला। कृपया पहले साइन अप करें।",error_invalid_otp:"अमान्य ओटीपी। कृपया पुनः प्रयास करें।",error_network:"नेटवर्क त्रुटि। कृपया अपना कनेक्शन जांचें।",retry:"पुनः प्रयास करें",close:"बंद करें",online:"ऑनलाइन",offline_limited:"ऑफलाइन - सीमित कार्यक्षमता",tip:"टिप",important:"महत्वपूर्ण",invalid_input:"अमान्य इनपुट",checking_connectivity:"कनेक्टिविटी जांच रहा है..."}},appState={activeUser:null,weatherChart:null,pages:["welcomePage","loginPage","signUpPage","homePage","otpPage"],currentLanguage:"en",isInitialized:!1,tempUserData:null,lastGeneratedOTP:null,otpExpiry:null,isOfflineMode:!1,loginAttempts:0,otpTimer:null,otpTimeLeft:120},districtData={Haryana:["Ambala","Bhiwani","Charkhi Dadri","Faridabad","Fatehabad","Gurugram","Hisar","Jhajjar","Jind","Kaithal","Karnal","Kurukshetra","Mahendragarh","Nuh","Palwal","Panchkula","Panipat","Rewari","Rohtak","Sirsa","Sonipat","Yamunanagar"],Punjab:["Amritsar","Barnala","Bathinda","Faridkot","Fatehgarh Sahib","Fazilka","Ferozepur","Gurdaspur","Hoshiarpur","Jalandhar","Kapurthala","Ludhiana","Mansa","Moga","Mohali","Muktsar","Pathankot","Patiala","Rupnagar","Sangrur","Shaheed Bhagat Singh Nagar","Tarn Taran"],"Uttar Pradesh":["Agra","Aligarh","Allahabad","Ambedkar Nagar","Amethi","Amroha","Auraiya","Azamgarh","Baghpat","Bahraich","Ballia","Balrampur","Banda","Barabanki","Bareilly","Basti","Bhadohi","Bijnor","Budaun","Bulandshahr","Chandauli","Chitrakoot","Deoria","Etah","Etawah","Faizabad","Farrukhabad","Fatehpur","Firozabad","Gautam Buddha Nagar","Ghaziabad","Ghazipur","Gonda","Gorakhpur","Hamirpur","Hapur","Hardoi","Hathras","Jalaun","Jaunpur","Jhansi","Kannauj","Kanpur Dehat","Kanpur Nagar","Kanshiram Nagar","Kaushambi","Kushinagar","Lakhimpur Kheri","Lalitpur","Lucknow","Maharajganj","Mahoba","Mainpuri","Mathura","Mau","Meerut","Mirzapur","Moradabad","Muzaffarnagar","Pilibhit","Pratapgarh","Rae Bareli","Rampur","Saharanpur","Sambhal","Sant Kabir Nagar","Shahjahanpur","Shamli","Shravasti","Siddharthnagar","Sitapur","Sonbhadra","Sultanpur","Unnao","Varanasi"]};function log(e,t=null){CONFIG.DEBUG_MODE&&console.log(`[Agritarmers] ${e}`,t||"")}function isValidMobile(e){return/^[6-9]\d{9}$/.test(e)}function isValidName(e){return e&&e.trim().length>=2}function showFieldError(e,t){const a=document.getElementById(e),n=document.getElementById(e+"Error");a&&n&&(a.classList.add("input-error"),n.textContent=t,n.style.display="block")}function clearFieldError(e){const t=document.getElementById(e),a=document.getElementById(e+"Error");t&&a&&(t.classList.remove("input-error"),a.style.display="none")}function showToast(e,t="info",a=3e3){const n=document.getElementById("toast-container"),s="toast-"+Date.now(),r=document.createElement("div");return r.id=s,r.className=`toast ${t}`,r.innerHTML=`\n        <div class="flex items-center">\n            <i class="fas ${"success"===t?"fa-check-circle":"error"===t?"fa-exclamation-circle":"fa-info-circle"} mr-3"></i>\n            <span>${e}</span>\n        </div>\n    `,n.appendChild(r),setTimeout(()=>r.classList.add("show"),10),setTimeout(()=>{r.classList.remove("show"),setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r)},300)},a),s}class TranslationSystem{constructor(){this.currentLang="en",this.initialized=!1}init(){const e=localStorage.getItem("agritarmers_language");e&&translations[e]&&(this.currentLang=e),this.updateLanguageDisplay(),this.applyTranslations(),this.initialized=!0}changeLanguage(e){translations[e]&&(this.currentLang=e,localStorage.setItem("agritarmers_language",e),this.updateLanguageDisplay(),this.applyTranslations())}updateLanguageDisplay(){document.querySelectorAll("#current-language, #current-language-desktop").forEach(e=>{e.textContent=this.currentLang.toUpperCase()})}applyTranslations(){document.querySelectorAll("[data-translate]").forEach(e=>{const t=e.getAttribute("data-translate"),a=this.getTranslation(t);a&&this.applyTranslationToElement(e,a)});const e=this.getTranslation("app_title");e&&(document.title=e)}getTranslation(e,t={}){let a=translations[this.currentLang]?.[e]||translations.en[e]||e;return Object.keys(t).forEach(e=>{a=a.replace(`{${e}}`,t[e])}),a}applyTranslationToElement(e,t){const a=e.tagName.toLowerCase();"input"===a||"textarea"===a||"select"===a?(e.hasAttribute("placeholder")&&e.setAttribute("placeholder",t),e.hasAttribute("value")&&e.setAttribute("value",t)):"img"===a&&e.hasAttribute("alt")?e.setAttribute("alt",t):e.textContent=t}t(e,t={}){return this.getTranslation(e,t)}}const translator=new TranslationSystem,NetworkManager={isOnline:navigator.onLine,init(){this.updateNetworkStatus(),this.setupEventListeners()},setupEventListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.updateNetworkStatus(),showToast(translator.t("toast_online"),"success")}),window.addEventListener("offline",()=>{this.isOnline=!1,this.updateNetworkStatus(),showToast(translator.t("toast_offline"),"info",3e3)})},updateNetworkStatus(){const e=document.getElementById("offline-indicator"),t=document.getElementById("offline-mode-banner");this.isOnline?(e&&e.classList.add("hidden"),t&&t.classList.add("hidden")):(e&&e.classList.remove("hidden"),t&&t.classList.remove("hidden")),appState.isOfflineMode=!this.isOnline}},ModalManager={currentModal:null,open(e,t,a="genericModal"){const n=document.getElementById("modal-container");this.close();let s=e;if(e.startsWith("translate:")){const t=e.replace("translate:","").trim();s=translator.t(t)}n.innerHTML=`\n            <div id="${a}" class="bg-white rounded-xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-hidden animate-fadeIn">\n                <div class="flex items-center justify-between p-6 border-b">\n                    <h3 class="text-2xl font-bold text-gray-800">${s}</h3>\n                    <button onclick="ModalManager.close()" class="text-gray-500 hover:text-gray-700 text-3xl font-light leading-none">&times;</button>\n                </div>\n                <div class="overflow-y-auto p-6" style="max-height: calc(90vh - 80px);">\n                    ${t}\n                </div>\n            </div>\n        `,n.classList.remove("hidden"),this.currentModal=a,setTimeout(()=>translator.applyTranslations(),100)},close(){const e=document.getElementById("modal-container");appState.weatherChart&&(appState.weatherChart.destroy(),appState.weatherChart=null),e.classList.add("hidden"),e.innerHTML="",this.currentModal=null}},PageManager={show(e){appState.pages.forEach(e=>{const t=document.getElementById(e);t&&t.classList.remove("active")});const t=document.getElementById(e);t&&t.classList.add("active"),this.updateNavigation();const a=document.getElementById("mobile-menu");a&&a.classList.add("hidden")},updateNavigation(){const e=document.getElementById("nav-actions"),t=document.getElementById("mobile-nav-actions");if(appState.activeUser){const a=`\n                <div class="flex items-center space-x-4">\n                    <span class="text-gray-700 hidden md:inline">${appState.activeUser.name}</span>\n                    <button onclick="handleLogout()" class="bg-gray-200 text-gray-800 font-medium py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors" data-translate="logout_button">Logout</button>\n                </div>\n            `,n=`\n                <div class="space-y-3">\n                    <div class="px-3 py-2 text-gray-700">${appState.activeUser.name}</div>\n                    <button onclick="handleLogout()" class="w-full text-left px-3 py-2 rounded-md text-gray-700 hover:bg-gray-100" data-translate="logout_button">Logout</button>\n                </div>\n            `;e&&(e.innerHTML=a),t&&(t.innerHTML=n)}else{const a='\n                <div class="flex items-center space-x-2">\n                    <button onclick="showPage(\'loginPage\')" class="text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium transition-colors" data-translate="login_button">Login</button>\n                    <button onclick="showPage(\'signUpPage\')" class="bg-[var(--primary-green)] text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-green-700 transition-colors" data-translate="get_started_button">Get Started</button>\n                </div>\n            ',n='\n                <div class="space-y-1">\n                    <button onclick="showPage(\'loginPage\')" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-100" data-translate="login_button">Login</button>\n                    <button onclick="showPage(\'signUpPage\')" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium bg-[var(--primary-green)] text-white hover:bg-green-700" data-translate="get_started_button">Get Started</button>\n                </div>\n            ';e&&(e.innerHTML=a),t&&(t.innerHTML=n)}setTimeout(()=>translator.applyTranslations(),50)}};function populateStates(){const e=document.getElementById("signUpState");if(!e)return;e.innerHTML='<option value="" data-translate="select_state">Select State</option>';Object.keys(districtData).sort().forEach(t=>{const a=document.createElement("option");a.value=t,a.textContent=t,e.appendChild(a)})}function populateDistricts(){const e=document.getElementById("signUpState"),t=document.getElementById("signUpDistrict");if(!e||!t)return;const a=e.value;t.innerHTML='<option value="" data-translate="select_district">Select District</option>',a&&districtData[a]?(districtData[a].forEach(e=>{const a=document.createElement("option");a.value=e,a.textContent=e,t.appendChild(a)}),t.disabled=!1):t.disabled=!0}const OTPManager={generateOTP(){const e=Math.floor(1e5+9e5*Math.random()).toString();return appState.lastGeneratedOTP=e,appState.otpExpiry=Date.now()+60*CONFIG.OTP_EXPIRY_MINUTES*1e3,e},isValidOTP:e=>appState.lastGeneratedOTP&&appState.otpExpiry?Date.now()>appState.otpExpiry?(showToast("OTP has expired. Please request a new one.","error"),!1):e===appState.lastGeneratedOTP:(console.log("No OTP or expiry found"),!1),startOTPTimer(){this.stopOTPTimer(),appState.otpTimeLeft=120;const e=document.getElementById("timer"),t=document.getElementById("resendOTPBtn");e&&(e.textContent="02:00"),t&&(t.disabled=!0,t.classList.remove("bg-green-500","text-white"),t.classList.add("bg-gray-200","text-gray-500")),appState.otpTimer=setInterval(()=>{appState.otpTimeLeft--;const a=Math.floor(appState.otpTimeLeft/60),n=appState.otpTimeLeft%60;e&&(e.textContent=`${a.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`),appState.otpTimeLeft<=0&&(this.stopOTPTimer(),e&&(e.textContent="00:00"),t&&(t.disabled=!1,t.classList.remove("bg-gray-200","text-gray-500"),t.classList.add("bg-green-500","text-white")))},1e3)},stopOTPTimer(){appState.otpTimer&&(clearInterval(appState.otpTimer),appState.otpTimer=null)},setupOTPInputs(){const e=document.querySelectorAll(".otp-digit");e.forEach((t,a)=>{t.value="",t.addEventListener("input",t=>{t.target.value=t.target.value.replace(/[^0-9]/g,""),1===t.target.value.length&&a<e.length-1&&e[a+1].focus();const n=Array.from(e).every(e=>1===e.value.length);n&&setTimeout(()=>{window.verifyOTP()},300)}),t.addEventListener("keydown",n=>{"Backspace"===n.key&&!t.value&&a>0&&e[a-1].focus(),"ArrowLeft"===n.key&&a>0&&(e[a-1].focus(),n.preventDefault()),"ArrowRight"===n.key&&a<e.length-1&&(e[a+1].focus(),n.preventDefault())}),t.addEventListener("paste",t=>{t.preventDefault();const a=t.clipboardData.getData("text").trim();if(6===a.length&&/^\d+$/.test(a)){a.split("").forEach((t,a)=>{e[a]&&(e[a].value=t)}),e[5]&&e[5].focus(),setTimeout(()=>{window.verifyOTP()},300)}})}),setTimeout(()=>{e[0]&&e[0].focus()},100)}},WeatherService={async getWeatherData(){try{let e="Noida";if(appState.activeUser&&appState.activeUser.district&&(e=appState.activeUser.district),NetworkManager.isOnline){const t=await this.fetchRealWeather(e);if(t&&!t.error)return this.cacheWeatherData(t),{...t,isMockData:!1,source:"api"}}const t=this.getCachedWeatherData();return t?{...t,isMockData:!1,source:"cache",cached:!0}:{...this.getMockWeatherData(),isMockData:!0,source:"mock"}}catch(e){console.log("Weather error:",e);const t=this.getCachedWeatherData();return t?{...t,isMockData:!1,source:"cache",cached:!0}:{...this.getMockWeatherData(),isMockData:!0,source:"mock"}}},async fetchRealWeather(e){try{const t=CONFIG.WEATHER_API_KEY,a=`${CONFIG.WEATHER_API_URL}/weather?q=${encodeURIComponent(e)},IN&appid=${t}&units=metric`,n=await fetch(a);if(!n.ok)return console.log("Weather API failed:",n.status),null;const s=await n.json();return{current:{temp:Math.round(s.main.temp),feelsLike:Math.round(s.main.feels_like),humidity:s.main.humidity,windSpeed:Math.round(3.6*s.wind.speed),windDirection:this.getWindDirection(s.wind.deg),description:s.weather[0].description,icon:s.weather[0].icon,pressure:s.main.pressure,sunrise:new Date(1e3*s.sys.sunrise).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),sunset:new Date(1e3*s.sys.sunset).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),visibility:(s.visibility/1e3).toFixed(1)},location:`${s.name}, ${s.sys.country}`}}catch(e){return console.log("Weather fetch error:",e),null}},getWindDirection:e=>["N","NE","E","SE","S","SW","W","NW"][Math.round(e/45)%8]||"N",getWeatherIcon:e=>({"01d":"fas fa-sun text-yellow-500","01n":"fas fa-moon text-gray-400","02d":"fas fa-cloud-sun text-orange-400","02n":"fas fa-cloud-moon text-gray-500","03d":"fas fa-cloud text-gray-500","03n":"fas fa-cloud text-gray-600","04d":"fas fa-cloud text-gray-600","04n":"fas fa-cloud text-gray-700","09d":"fas fa-cloud-rain text-blue-500","09n":"fas fa-cloud-rain text-blue-600","10d":"fas fa-cloud-sun-rain text-blue-400","10n":"fas fa-cloud-moon-rain text-blue-500","11d":"fas fa-bolt text-yellow-600","11n":"fas fa-bolt text-yellow-700","13d":"fas fa-snowflake text-blue-300","13n":"fas fa-snowflake text-blue-400","50d":"fas fa-smog text-gray-400","50n":"fas fa-smog text-gray-500"}[e]||"fas fa-cloud text-gray-500"),getMockWeatherData:()=>({current:{temp:28,feelsLike:30,humidity:65,windSpeed:"12",windDirection:"NE",description:"Partly Cloudy",icon:"02d",pressure:1013,sunrise:"06:15",sunset:"18:45",visibility:"10"},location:appState.activeUser?.district||"Noida, India"}),cacheWeatherData(e){try{localStorage.setItem("cached_weather",JSON.stringify({data:e,timestamp:Date.now()}))}catch(e){console.log("Cache error:",e)}},getCachedWeatherData(){try{const e=localStorage.getItem("cached_weather");if(e){const t=JSON.parse(e);if(Date.now()-t.timestamp<36e5)return t.data}}catch(e){console.log("Get cache error:",e)}return null}};async function showWeatherModal(){ModalManager.open("translate:weather_info",'\n        <div class="text-center p-8">\n            <div class="loader inline-block mb-4"></div>\n            <p class="text-gray-600" data-translate="weather_loading">Loading weather data...</p>\n        </div>\n    ',"weatherModal");try{const e=await WeatherService.getWeatherData(),t=e.isMockData||!NetworkManager.isOnline,a="cache"===e.source;let n=translator.t("good_weather_alert");e.current.temp>35?n=translator.t("high_temp_alert"):e.current.temp<10&&(n=translator.t("low_temp_alert"));const s=`\n            <div class="space-y-6">\n                <div class="text-center mb-2">\n                    <h4 class="text-lg font-bold">${e.location}</h4>\n                    <p class="text-gray-600">${(new Date).toLocaleDateString(translator.currentLang,{weekday:"long",year:"numeric",month:"long",day:"numeric"})}</p>\n                    ${t?`\n                        <div class="inline-block mt-2 px-3 py-1 ${a?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"} text-xs rounded-full">\n                            <i class="fas ${a?"fa-database":"fa-wifi-slash"} mr-1"></i>\n                            <span>${a?"Cached Data":translator.t("offline_weather")}</span>\n                        </div>\n                    `:'\n                        <div class="inline-block mt-2 px-3 py-1 bg-green-100 text-green-800 text-xs rounded-full">\n                            <i class="fas fa-wifi mr-1"></i>\n                            <span>Live Data</span>\n                        </div>\n                    '}\n                </div>\n                \n                <div class="bg-gradient-to-r from-blue-50 to-green-50 rounded-xl p-6 border border-blue-100">\n                    <div class="flex items-center justify-between">\n                        <div>\n                            <div class="flex items-center">\n                                <i class="${WeatherService.getWeatherIcon(e.current.icon)} text-5xl mr-4"></i>\n                                <div>\n                                    <div class="text-4xl font-bold text-gray-800">${e.current.temp}°C</div>\n                                    <p class="text-gray-600 capitalize">${e.current.description}</p>\n                                    <p class="text-sm text-gray-500">\n                                        <span data-translate="feels_like">Feels like</span> ${e.current.feelsLike}°C\n                                    </p>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-6">\n                        <div class="text-center p-3 bg-white rounded-lg shadow-sm">\n                            <i class="fas fa-wind text-blue-500 mb-1"></i>\n                            <div class="text-sm text-gray-600" data-translate="wind">Wind</div>\n                            <div class="font-bold">${e.current.windSpeed} km/h</div>\n                            <div class="text-xs text-gray-500">${e.current.windDirection}</div>\n                        </div>\n                        <div class="text-center p-3 bg-white rounded-lg shadow-sm">\n                            <i class="fas fa-tint text-blue-400 mb-1"></i>\n                            <div class="text-sm text-gray-600" data-translate="humidity">Humidity</div>\n                            <div class="font-bold">${e.current.humidity}%</div>\n                        </div>\n                        <div class="text-center p-3 bg-white rounded-lg shadow-sm">\n                            <i class="fas fa-compress-alt text-green-500 mb-1"></i>\n                            <div class="text-sm text-gray-600" data-translate="pressure">Pressure</div>\n                            <div class="font-bold">${e.current.pressure} hPa</div>\n                        </div>\n                        <div class="text-center p-3 bg-white rounded-lg shadow-sm">\n                            <i class="fas fa-eye text-purple-500 mb-1"></i>\n                            <div class="text-sm text-gray-600" data-translate="visibility">Visibility</div>\n                            <div class="font-bold">${e.current.visibility} km</div>\n                        </div>\n                    </div>\n                    \n                    <div class="grid grid-cols-2 gap-4 mt-6">\n                        <div class="flex items-center p-3 bg-yellow-50 rounded-lg">\n                            <i class="fas fa-sun text-yellow-500 text-2xl mr-3"></i>\n                            <div>\n                                <div class="text-sm text-gray-600" data-translate="sunrise">Sunrise</div>\n                                <div class="font-bold">${e.current.sunrise}</div>\n                            </div>\n                        </div>\n                        <div class="flex items-center p-3 bg-indigo-50 rounded-lg">\n                            <i class="fas fa-moon text-indigo-500 text-2xl mr-3"></i>\n                            <div>\n                                <div class="text-sm text-gray-600" data-translate="sunset">Sunset</div>\n                                <div class="font-bold">${e.current.sunset}</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">\n                    <div class="flex items-start">\n                        <i class="fas fa-lightbulb text-yellow-600 mt-1 mr-3"></i>\n                        <div>\n                            <p class="font-medium text-yellow-800" data-translate="farming_advisory">Farming Advisory</p>\n                            <p class="text-sm text-yellow-700 mt-1">${n}</p>\n                            ${t?`\n                                <p class="text-xs text-yellow-600 mt-2">\n                                    <i class="fas fa-info-circle mr-1"></i>\n                                    ${translator.t("connect_internet")}\n                                </p>\n                            `:""}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,r=document.querySelector("#weatherModal .overflow-y-auto");r&&(r.innerHTML=s,translator.applyTranslations())}catch(e){log("Weather modal error:",e);const t=`\n            <div class="text-center p-8">\n                <i class="fas fa-exclamation-triangle text-5xl text-red-500 mb-4"></i>\n                <h4 class="text-xl font-bold mb-2" data-translate="weather_error">Unable to fetch weather data</h4>\n                <p class="text-gray-600 mb-4">${translator.t("error_network")}</p>\n                <div class="flex flex-col gap-2">\n                    <button onclick="showWeatherModal()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">\n                        ${translator.t("retry")}\n                    </button>\n                    <button onclick="ModalManager.close()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition-colors">\n                        ${translator.t("close")}\n                    </button>\n                </div>\n            </div>\n        `,a=document.querySelector("#weatherModal .overflow-y-auto");a&&(a.innerHTML=t,translator.applyTranslations())}}function showSeedModal(){const e=(new Date).getMonth()+1;let t="Kharif";e>=10||e<=2?t="Rabi":e>=3&&e<=6&&(t="Zaid");const a=`\n        <div class="space-y-6">\n            <div>\n                <h4 class="text-lg font-bold mb-2">${translator.t("seed_recommendation",{season:t})}</h4>\n                <div class="flex flex-wrap gap-2">\n                    ${{Kharif:["Rice","Maize","Cotton","Soybean","Groundnut"],Rabi:["Wheat","Barley","Mustard","Gram","Peas"],Zaid:["Watermelon","Muskmelon","Cucumber","Bitter Gourd"]}[t].map(e=>`\n                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">${e}</span>\n                    `).join("")}\n                </div>\n            </div>\n            \n            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">\n                <p class="text-sm text-yellow-800">\n                    <i class="fas fa-lightbulb mr-2"></i>\n                    <strong>${translator.t("tip")}:</strong> ${translator.t("seed_tip")}\n                </p>\n            </div>\n            \n            <div class="text-sm text-gray-600">\n                <p>${translator.t("seed_consult")}</p>\n            </div>\n        </div>\n    `;ModalManager.open("translate:seed_advice",a,"seedModal")}function showFertilizerModal(){const e=`\n        <div class="space-y-6">\n            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">\n                <div class="bg-green-50 p-4 rounded-lg">\n                    <h5 class="font-bold mb-2" data-translate="npk_ratio">NPK Ratio</h5>\n                    <p class="text-3xl font-bold text-gray-800">4:2:1</p>\n                    <p class="text-sm text-gray-600" data-translate="nitrogen_phosphorus_potassium">Nitrogen:Phosphorus:Potassium</p>\n                </div>\n                <div class="bg-blue-50 p-4 rounded-lg">\n                    <h5 class="font-bold mb-2" data-translate="application_time">Application Time</h5>\n                    <p class="text-lg font-bold text-gray-800" data-translate="before_sowing">Before Sowing</p>\n                    <p class="text-sm text-gray-600" data-translate="basal_dose">Basal dose recommended</p>\n                </div>\n            </div>\n            \n            <div class="bg-red-50 border-l-4 border-red-400 p-4">\n                <p class="text-sm text-red-800">\n                    <i class="fas fa-exclamation-triangle mr-2"></i>\n                    <strong data-translate="important">Important:</strong> ${translator.t("soil_testing_important")}\n                </p>\n            </div>\n        </div>\n    `;ModalManager.open("translate:fertilizer_guide",e,"fertilizerModal")}function showCropCalendarModal(){const e=(new Date).getMonth()+1;let t=translator.t("zaid_time");e>=5&&e<=8?t=translator.t("kharif_time"):(e>=9||e<=1)&&(t=translator.t("rabi_time"));const a=`\n        <div class="space-y-6">\n            <div class="overflow-x-auto">\n                <table class="w-full text-sm">\n                    <thead>\n                        <tr class="bg-gray-100">\n                            <th class="p-3 text-left" data-translate="season">Season</th>\n                            <th class="p-3 text-left" data-translate="sowing">Sowing</th>\n                            <th class="p-3 text-left" data-translate="harvesting">Harvesting</th>\n                            <th class="p-3 text-left" data-translate="crops">Crops</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        ${[{season:"Kharif",sowing:"Jun - Jul",harvesting:"Sep - Oct",crops:"Rice, Maize, Cotton"},{season:"Rabi",sowing:"Oct - Nov",harvesting:"Mar - Apr",crops:"Wheat, Barley, Mustard"},{season:"Zaid",sowing:"Mar - Jun",harvesting:"Jun - Jul",crops:"Watermelon, Cucumber"}].map(e=>`\n                            <tr class="border-b">\n                                <td class="p-3 font-medium">${e.season}</td>\n                                <td class="p-3">${e.sowing}</td>\n                                <td class="p-3">${e.harvesting}</td>\n                                <td class="p-3">${e.crops}</td>\n                            </tr>\n                        `).join("")}\n                    </tbody>\n                </table>\n            </div>\n            \n            <div class="bg-green-50 p-4 rounded-lg">\n                <h5 class="font-bold mb-2" data-translate="current_recommendation">Current Recommendation</h5>\n                <p class="text-gray-700">${t}</p>\n            </div>\n        </div>\n    `;ModalManager.open("translate:crop_calendar",a,"calendarModal")}function proceedToOTP(e){const t=OTPManager.generateOTP();PageManager.show("otpPage"),document.getElementById("otpPhoneNumber").textContent=`+91 ${e}`,document.getElementById("demoOTP").textContent=t,OTPManager.setupOTPInputs(),OTPManager.startOTPTimer(),showToast(translator.t("toast_otp_sent"),"success")}window.handleSignUp=function(){const e=document.getElementById("signUpName")?.value.trim()||"",t=document.getElementById("signUpMobile")?.value.trim()||"",a=document.getElementById("signUpState")?.value||"",n=document.getElementById("signUpDistrict")?.value||"";["signUpName","signUpMobile","signUpState","signUpDistrict"].forEach(clearFieldError);let s=!1;if(isValidName(e)||(showFieldError("signUpName",translator.t("name_error")),s=!0),isValidMobile(t)||(showFieldError("signUpMobile",translator.t("mobile_error")),s=!0),a||(showFieldError("signUpState",translator.t("state_error")),s=!0),n||(showFieldError("signUpDistrict",translator.t("district_error")),s=!0),s)return;const r={name:e,mobile:t,state:a,district:n,verified:!0,joined:(new Date).toISOString(),lastLogin:(new Date).toISOString()};localStorage.setItem("agritarmers_user",JSON.stringify(r)),appState.activeUser=r,PageManager.show("homePage");const o=document.getElementById("farmerName"),i=document.getElementById("farmerLocation");o&&(o.textContent=r.name),i&&(i.textContent=`${r.district}, ${r.state}`),showToast(translator.t("toast_signup_success"),"success")},window.handleLogin=function(){const e=document.getElementById("loginMobile")?.value.trim()||"";if(clearFieldError("loginMobile"),!isValidMobile(e))return void showFieldError("loginMobile",translator.t("mobile_error"));const t=localStorage.getItem("agritarmers_user");if(t){const a=JSON.parse(t);if(a.mobile===e)return appState.tempUserData=a,void proceedToOTP(e)}appState.tempUserData={mobile:e},proceedToOTP(e)},window.verifyOTP=function(){const e=document.querySelectorAll(".otp-digit");let t="";if(e.forEach(e=>{t+=e.value}),6===t.length)if(OTPManager.isValidOTP(t)){if(OTPManager.stopOTPTimer(),appState.tempUserData)if(appState.tempUserData.name){appState.activeUser=appState.tempUserData,appState.activeUser.lastLogin=(new Date).toISOString(),localStorage.setItem("agritarmers_user",JSON.stringify(appState.activeUser)),PageManager.show("homePage");const e=document.getElementById("farmerName"),t=document.getElementById("farmerLocation");e&&(e.textContent=appState.activeUser.name),t&&appState.activeUser.district&&appState.activeUser.state&&(t.textContent=`${appState.activeUser.district}, ${appState.activeUser.state}`),showToast(translator.t("toast_login_success"),"success")}else PageManager.show("signUpPage"),document.getElementById("signUpMobile").value=appState.tempUserData.mobile,showToast("Please complete your registration","info");appState.lastGeneratedOTP=null,appState.otpExpiry=null,appState.tempUserData=null,appState.loginAttempts=0}else appState.loginAttempts++,appState.loginAttempts>=CONFIG.MAX_LOGIN_ATTEMPTS?(showToast("Too many failed attempts. Please try again later.","error"),PageManager.show("loginPage"),appState.loginAttempts=0):(showToast(translator.t("error_invalid_otp"),"error"),e.forEach(e=>{e.value=""}),setTimeout(()=>{e[0]&&e[0].focus()},100));else showToast(translator.t("error_invalid_otp"),"error")},window.resendOTP=function(){const e=OTPManager.generateOTP();document.getElementById("demoOTP").textContent=e,document.querySelectorAll(".otp-digit").forEach(e=>{e.value=""}),OTPManager.setupOTPInputs(),OTPManager.startOTPTimer(),showToast(translator.t("toast_new_otp"),"success")},window.handleLogout=function(){appState.activeUser=null,appState.tempUserData=null,appState.lastGeneratedOTP=null,appState.loginAttempts=0,PageManager.show("welcomePage"),showToast(translator.t("toast_logout"),"info")},window.showPage=PageManager.show,window.openWeatherModal=showWeatherModal,window.openSeedModal=showSeedModal,window.openFertilizerModal=showFertilizerModal,window.openCropCalendarModal=showCropCalendarModal,window.openMarketPricesModal=()=>{ModalManager.open("translate:market_prices",`<div class="text-center p-8"><div class="loader inline-block mb-4"></div><p>${translator.t("fetching_prices")}</p></div>`,"marketModal"),setTimeout(()=>{const e=document.querySelector("#marketModal .overflow-y-auto");e&&(e.innerHTML='\n            <div class="space-y-4">\n                <div class="flex justify-between p-3 bg-gray-50 rounded-lg">\n                    <span data-translate="wheat_price">Wheat</span>\n                    <span class="font-bold">₹2,300<span data-translate="per_quintal">/q</span></span>\n                </div>\n                <div class="flex justify-between p-3 bg-gray-50 rounded-lg">\n                    <span data-translate="rice_price">Rice</span>\n                    <span class="font-bold">₹3,800<span data-translate="per_quintal">/q</span></span>\n                </div>\n                <div class="flex justify-between p-3 bg-gray-50 rounded-lg">\n                    <span data-translate="cotton_price">Cotton</span>\n                    <span class="font-bold">₹6,500<span data-translate="per_intal">/q</span></span>\n                </div>\n            </div>\n        ',translator.applyTranslations())},1500)},window.openSoilHealthModal=()=>{const e=`\n        <div class="space-y-6">\n            <div class="bg-green-50 p-4 rounded-lg">\n                <h4 class="font-bold mb-2" data-translate="soil_testing_steps">Soil Testing Steps</h4>\n                <ol class="list-decimal list-inside space-y-2 text-gray-700">\n                    <li data-translate="soil_step_1">Collect soil samples from different spots</li>\n                    <li data-translate="soil_step_2">Mix samples thoroughly</li>\n                    <li data-translate="soil_step_3">Visit nearest Krishi Vigyan Kendra</li>\n                    <li data-translate="soil_step_4">Get soil health card with recommendations</li>\n                </ol>\n            </div>\n            \n            <div class="bg-blue-50 p-4 rounded-lg">\n                <h4 class="font-bold mb-2" data-translate="kvk_contact">KVK Contact Info</h4>\n                <p class="text-sm text-gray-700">${translator.t("kvk_info")}</p>\n            </div>\n        </div>\n    `;ModalManager.open("translate:soil_health",e,"soilModal")},window.closeModal=ModalManager.close;const PwaManager={deferredPrompt:null,init(){window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),this.deferredPrompt=e,this.showInstallButton()}),window.addEventListener("appinstalled",()=>{console.log("PWA installed successfully"),this.hideInstallButton(),showToast("Agritarmers installed successfully!","success")}),this.checkIfAppIsInstalled()},showInstallButton(){if(this.isAppInstalled())return void this.hideInstallButton();const e=document.getElementById("pwa-install-button");e&&(e.style.display="flex",e.onclick=()=>this.installApp())},hideInstallButton(){const e=document.getElementById("pwa-install-button");e&&(e.style.display="none")},async installApp(){if(!this.deferredPrompt)return void console.log("No install prompt available");this.deferredPrompt.prompt();const{outcome:e}=await this.deferredPrompt.userChoice;"accepted"===e?(console.log("User accepted the install prompt"),this.deferredPrompt=null,this.hideInstallButton()):console.log("User dismissed the install prompt")},isAppInstalled:()=>window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone,checkIfAppIsInstalled(){this.isAppInstalled()&&(this.hideInstallButton(),console.log("App is running in standalone mode"))}};function openModal(e){let t="",a="";switch(e){case"privacy":t="Privacy Policy",a='\n                <div class="space-y-4">\n                    <p class="text-gray-700">We value your privacy and are committed to protecting your personal information.</p>\n                    <p class="text-gray-700">We collect only necessary data to provide you with the best farming assistance.</p>\n                </div>\n            ';break;case"terms":t="Terms of Use",a='\n                <div class="space-y-4">\n                    <p class="text-gray-700">By using Agritarmers, you agree to our terms and conditions.</p>\n                    <p class="text-gray-700">All information provided is for educational and informational purposes only.</p>\n                </div>\n            ';break;case"sitemap":t="Sitemap",a='\n                <div class="space-y-2">\n                    <p><a href="#" onclick="showPage(\'welcomePage\')" class="text-green-600 hover:underline">Home</a></p>\n                    <p><a href="#" onclick="showPage(\'loginPage\')" class="text-green-600 hover:underline">Login</a></p>\n                    <p><a href="#" onclick="showPage(\'signUpPage\')" class="text-green-600 hover:underline">Sign Up</a></p>\n                </div>\n            ';break;case"services":t="Our Services",a='\n                <div class="space-y-4">\n                    <ul class="list-disc pl-5 space-y-2">\n                        <li>Weather Forecasting</li>\n                        <li>Seed Recommendations</li>\n                        <li>Fertilizer Guidance</li>\n                        <li>Market Price Updates</li>\n                        <li>Crop Calendar</li>\n                        <li>Soil Health Testing Guidance</li>\n                    </ul>\n                </div>\n            ';break;case"contact":t="Contact Us",a='\n                <div class="space-y-4">\n                    <p class="text-gray-700"><strong>Email:</strong> help@agritarmers.com</p>\n                    <p class="text-gray-700"><strong>Phone:</strong> +91 701XXXXXXX</p>\n                    <p class="text-gray-700"><strong>Address:</strong> [Address to be added]</p>\n                </div>\n            '}ModalManager.open(t,a)}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("mobile-menu-button"),t=document.getElementById("mobile-menu");e&&t&&e.addEventListener("click",function(){t.classList.toggle("hidden")});const a=document.getElementById("signUpState");a&&a.addEventListener("change",populateDistricts);const n=(e,t)=>{const a=document.getElementById(e);a&&a.addEventListener("blur",function(){if(t(this.value))clearFieldError(e);else{const t={signUpName:translator.t("name_error"),signUpMobile:translator.t("mobile_error"),loginMobile:translator.t("mobile_error")};showFieldError(e,t[e]||translator.t("invalid_input"))}})};n("signUpName",isValidName),n("signUpMobile",isValidMobile),n("loginMobile",isValidMobile),document.querySelectorAll(".language-option").forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-lang");translator.changeLanguage(e),document.querySelectorAll(".language-selector").forEach(e=>{e.classList.remove("active")})})}),document.querySelectorAll("#desktop-language-btn, #mobile-language-btn").forEach(e=>{e.addEventListener("click",function(e){e.stopPropagation();const t=this.closest(".language-selector");t&&t.classList.toggle("active")})}),document.addEventListener("click",function(){document.querySelectorAll(".language-selector").forEach(e=>{e.classList.remove("active")})});const s=document.querySelectorAll(".lazy-image"),r=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target,a=t.getAttribute("data-src");a&&(t.src=a,t.classList.add("loaded")),r.unobserve(t)}})});s.forEach(e=>r.observe(e)),PwaManager.init()}),window.addEventListener("load",function(){const e=document.getElementById("loadingScreen"),t=document.getElementById("loading-progress"),a=document.getElementById("app"),n=e=>{t&&(t.textContent=e)};n("Initializing app..."),setTimeout(function(){try{n("Setting up network..."),NetworkManager.init(),n("Loading language..."),translator.init(),n("Preparing data..."),populateStates(),n("Finalizing..."),PageManager.updateNavigation(),appState.isInitialized=!0,setTimeout(()=>{e&&(e.style.display="none"),a&&a.classList.remove("opacity-0"),log("App initialized successfully");const t=localStorage.getItem("agritarmers_user");if(t){const e=JSON.parse(t);appState.activeUser=e,PageManager.show("homePage");const a=document.getElementById("farmerName"),n=document.getElementById("farmerLocation");a&&(a.textContent=e.name),n&&e.district&&e.state&&(n.textContent=`${e.district}, ${e.state}`)}localStorage.getItem("agritarmers_visited")||setTimeout(()=>{showToast("Welcome to Agritarmers!","info",3e3),localStorage.setItem("agritarmers_visited","true")},1e3)},200)}catch(t){console.error("Initialization error:",t),setTimeout(()=>{e&&(e.style.display="none"),a&&a.classList.remove("opacity-0")},300)}},100)}),window.addEventListener("beforeunload",function(){appState.activeUser&&localStorage.setItem("agritarmers_user",JSON.stringify(appState.activeUser))}),document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&appState.isInitialized&&NetworkManager.updateNetworkStatus()}),window.openModal=openModal;const OfflineCache={cacheWeatherData(e){try{localStorage.setItem("cached_weather",JSON.stringify({data:e,timestamp:Date.now()}))}catch(e){console.log("Weather cache error:",e)}},getCachedWeatherData(){try{const e=localStorage.getItem("cached_weather");if(e){const t=JSON.parse(e);if(Date.now()-t.timestamp<36e5)return t.data}}catch(e){console.log("Get cached weather error:",e)}return null},clearOldCache(){const e=Date.now()-6048e5;["cached_weather"].forEach(t=>{try{const a=localStorage.getItem(t);if(a){JSON.parse(a).timestamp<e&&localStorage.removeItem(t)}}catch(e){console.log("Clear cache error:",e)}})}};OfflineCache.clearOldCache();